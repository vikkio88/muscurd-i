name: On Release Published

on:
  release:
    types: [published]

jobs:
  build-publish:
    timeout-minutes: 20
    runs-on: windows-latest

    steps:
    - name: Checkout
      uses: actions/checkout@v1
 
    - name: Setup .NET Core
      uses: actions/setup-dotnet@v1
    
    - name: Creating Bin folder
      run: mkdir bin_release

# Might want to use Matrix here
    - name: Build Binary Linux
      run: dotnet publish -c Release -o publish -p:PublishReadyToRun=true -p:PublishSingleFile=true -p:PublishTrimmed=true --self-contained true -p:RuntimeIdentifier=linux-x64 -p:IncludeNativeLibrariesForSelfExtract=true -p:OutputType=WinExe
      working-directory: Muscurdi
    
    - name: Zip Binary
      run: tar -cvzf "Muscurdi_linux.zip" "publish" && mv Muscurdi_linux.zip ../bin_release 
      working-directory: Muscurdi
    
    - name: Build Binary Win
      run: dotnet publish -c Release -o publish -p:PublishReadyToRun=true -p:PublishSingleFile=true -p:PublishTrimmed=true --self-contained true -p:RuntimeIdentifier=win-x64 -p:IncludeNativeLibrariesForSelfExtract=true -p:OutputType=WinExe
      working-directory: Muscurdi
    
    - name: Zip Binary
      run: tar -cvzf "Muscurdi_win.zip" "publish" && mv Muscurdi_win.zip ../bin_release 
      working-directory: Muscurdi

    - name: Build Binary MacOs
      run: dotnet publish -c Release -o publish -p:PublishReadyToRun=true -p:PublishSingleFile=true -p:PublishTrimmed=true --self-contained true -p:RuntimeIdentifier=osx-x64 -p:IncludeNativeLibrariesForSelfExtract=true -p:OutputType=WinExe
      working-directory: Muscurdi
    
    - name: Zip Binary
      run: tar -cvzf "Muscurdi_osx.zip" "publish" && mv Muscurdi_osx.zip ../bin_release 
      working-directory: Muscurdi

    - name: Upload Bin Linux
      uses: djn24/add-asset-to-release@v1
      with:
        token: ${{secrets.GITHUB_TOKEN}}
        path: '/bin_release/Muscurdi_linux.zip'

    - name: Upload Bin Win
      uses: djn24/add-asset-to-release@v1
      with:
        token: ${{secrets.GITHUB_TOKEN}}
        path: '/bin_release/Muscurdi_win.zip'

    - name: Upload Bin Mac
      uses: djn24/add-asset-to-release@v1
      with:
        token: ${{secrets.GITHUB_TOKEN}}
        path: '/bin_release/Muscurdi_osx.zip'
